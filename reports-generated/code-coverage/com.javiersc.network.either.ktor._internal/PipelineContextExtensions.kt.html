<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PipelineContextExtensions.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">:</a> &gt; <a href="index.source.html" class="el_package">com.javiersc.network.either.ktor._internal</a> &gt; <span class="el_source">PipelineContextExtensions.kt</span></div><h1>PipelineContextExtensions.kt</h1><pre class="source lang-java linenums">@file:Suppress(&quot;MagicNumber&quot;)

package com.javiersc.network.either.ktor._internal

import com.javiersc.kotlin.stdlib.secondOrNull
import com.javiersc.network.either.NetworkEither
import io.ktor.client.call.HttpClientCall
import io.ktor.client.statement.HttpResponseContainer
import io.ktor.util.pipeline.PipelineContext
import io.ktor.util.reflect.Type
import io.ktor.util.reflect.TypeInfo
import io.ktor.util.reflect.platformType
import kotlin.reflect.KClass
import kotlin.reflect.KClassifier
import kotlin.reflect.KType
import kotlin.reflect.typeOf

internal val PipelineContext&lt;HttpResponseContainer, HttpClientCall&gt;.networkEitherTypeInfo: TypeInfo
    get() {
<span class="fc" id="L20">        val typeInfo =</span>
<span class="fc" id="L21">            when (context.response.status.value) {</span>
<span class="pc bpc" id="L22" title="1 of 6 branches missed.">                in SUCCESS_RANGE -&gt; successTypeInfo</span>
<span class="pc bpc" id="L23" title="3 of 6 branches missed.">                in ERROR_RANGE -&gt; failureTypeInfo</span>
<span class="nc" id="L24">                else -&gt; null</span>
            }
<span class="pc bpc" id="L26" title="1 of 2 branches missed.">        return checkNotNull(typeInfo) { &quot;TypeInfo must not be null, this should not be happening&quot; }</span>
    }

internal val PipelineContext&lt;HttpResponseContainer, HttpClientCall&gt;.failureTypeInfo: TypeInfo?
    get() =
<span class="pc bpc" id="L31" title="1 of 2 branches missed.">        if (isNetworkEither) {</span>
<span class="fc" id="L32">            val failureKotlinType: KType =</span>
<span class="pc bpc" id="L33" title="4 of 8 branches missed.">                checkNotNull(subject.expectedType.kotlinType?.arguments?.firstOrNull()?.type)</span>
<span class="fc" id="L34">            val failureType: KClass&lt;*&gt; = failureKotlinType.classifier as KClass&lt;*&gt;</span>
<span class="fc" id="L35">            val failureReifiedType: Type = failureKotlinType.platformType</span>

<span class="fc" id="L37">            TypeInfo(</span>
<span class="fc" id="L38">                type = failureType,</span>
<span class="fc" id="L39">                reifiedType = failureReifiedType,</span>
<span class="fc" id="L40">                kotlinType = failureKotlinType,</span>
            )
<span class="pc" id="L42">        } else null</span>

internal val PipelineContext&lt;HttpResponseContainer, HttpClientCall&gt;.successTypeInfo: TypeInfo?
    get() =
<span class="pc bpc" id="L46" title="1 of 2 branches missed.">        if (isNetworkEither) {</span>
<span class="fc" id="L47">            val successKotlinType: KType =</span>
<span class="pc bpc" id="L48" title="4 of 8 branches missed.">                checkNotNull(subject.expectedType.kotlinType?.arguments?.secondOrNull()?.type)</span>
<span class="fc" id="L49">            val successType: KClass&lt;*&gt; = successKotlinType.classifier as KClass&lt;*&gt;</span>
<span class="fc" id="L50">            val successReifiedType: Type = successKotlinType.platformType</span>

<span class="fc" id="L52">            TypeInfo(</span>
<span class="fc" id="L53">                type = successType,</span>
<span class="fc" id="L54">                reifiedType = successReifiedType,</span>
<span class="fc" id="L55">                kotlinType = successKotlinType,</span>
            )
<span class="pc" id="L57">        } else null</span>

internal val PipelineContext&lt;HttpResponseContainer, HttpClientCall&gt;.isNetworkEither: Boolean
    get() =
<span class="fc bfc" id="L61" title="All 2 branches covered.">        (kClassifier == networkEitherKClassifier) ||</span>
<span class="fc bfc" id="L62" title="All 2 branches covered.">            isNetworkEitherFailure ||</span>
<span class="pc bpc" id="L63" title="1 of 2 branches missed.">            isNetworkEitherSuccess ||</span>
<span class="fc bfc" id="L64" title="All 2 branches covered.">            isNetworkEitherFailureLocal ||</span>
<span class="fc bfc" id="L65" title="All 2 branches covered.">            isNetworkEitherFailureRemote</span>

internal val PipelineContext&lt;HttpResponseContainer, HttpClientCall&gt;.isNetworkEitherFailureLocal:
    Boolean
<span class="fc" id="L69">    get() = kClassifier == networkEitherFailureLocalKClassifier</span>

internal val PipelineContext&lt;HttpResponseContainer, HttpClientCall&gt;.isNetworkEitherFailureRemote:
    Boolean
<span class="fc" id="L73">    get() = kClassifier == networkEitherFailureRemoteKClassifier</span>

internal val PipelineContext&lt;HttpResponseContainer, HttpClientCall&gt;.isNetworkEitherFailure: Boolean
<span class="fc" id="L76">    get() = kClassifier == networkEitherFailureKClassifier</span>

internal val PipelineContext&lt;HttpResponseContainer, HttpClientCall&gt;.isNetworkEitherSuccess: Boolean
<span class="fc" id="L79">    get() = kClassifier == networkEitherSuccessKClassifier</span>

internal val networkEitherFailureLocalKClassifier: KClassifier
    get() =
<span class="pc bpc" id="L83" title="1 of 2 branches missed.">        checkNotNull(typeOf&lt;NetworkEither.Failure.Local&gt;().classifier) {</span>
<span class="nc" id="L84">            &quot;`NetworkEither.Failure.Local should be denotable in Kotlin&quot;</span>
<span class="fc" id="L85">        }</span>

internal val networkEitherFailureRemoteKClassifier: KClassifier
    get() =
<span class="pc bpc" id="L89" title="1 of 2 branches missed.">        checkNotNull(typeOf&lt;NetworkEither.Failure.Remote&gt;().classifier) {</span>
<span class="nc" id="L90">            &quot;`NetworkEither.Failure.Local should be denotable in Kotlin&quot;</span>
<span class="fc" id="L91">        }</span>

internal val networkEitherFailureKClassifier: KClassifier
    get() =
<span class="pc bpc" id="L95" title="1 of 2 branches missed.">        checkNotNull(typeOf&lt;NetworkEither.Failure&lt;*&gt;&gt;().classifier) {</span>
<span class="nc" id="L96">            &quot;`NetworkEither.Failure should be denotable in Kotlin&quot;</span>
<span class="fc" id="L97">        }</span>

internal val networkEitherSuccessKClassifier: KClassifier
    get() =
<span class="pc bpc" id="L101" title="1 of 2 branches missed.">        checkNotNull(typeOf&lt;NetworkEither.Success&lt;*&gt;&gt;().classifier) {</span>
<span class="nc" id="L102">            &quot;`NetworkEither.Failure should be denotable in Kotlin&quot;</span>
<span class="fc" id="L103">        }</span>

internal val networkEitherKClassifier: KClassifier
    get() =
<span class="pc bpc" id="L107" title="1 of 2 branches missed.">        checkNotNull(typeOf&lt;NetworkEither&lt;*, *&gt;&gt;().classifier) {</span>
<span class="nc" id="L108">            &quot;`NetworkEither should be denotable in Kotlin&quot;</span>
<span class="fc" id="L109">        }</span>

internal val PipelineContext&lt;HttpResponseContainer, HttpClientCall&gt;.kClassifier: KClassifier?
<span class="pc bpc" id="L112" title="1 of 2 branches missed.">    get() = subject.expectedType.kotlinType?.classifier</span>

internal val PipelineContext&lt;
    HttpResponseContainer, HttpClientCall
&gt;.requestContentIsNetworkFailureLocal: Boolean
<span class="fc" id="L117">    get() = context.request.content is LocalErrorOutgoing</span>

internal val PipelineContext&lt;
    HttpResponseContainer, HttpClientCall
&gt;.requestContentIsNetworkFailureRemote: Boolean
<span class="fc" id="L122">    get() = context.request.content is RemoteErrorOutgoing</span>

<span class="fc" id="L124">internal val SUCCESS_RANGE: IntRange = 200..299</span>

<span class="pc" id="L126">internal val ERROR_RANGE: IntRange = 400..599</span>
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>